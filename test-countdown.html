<!DOCTYPE html>
<html>
<head>
    <title>Countdown Watcher Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            height: 200vh; /* Make page scrollable */
        }
        .countdown {
            font-size: 24px;
            margin: 20px 0;
            padding: 10px;
            background: #f0f0f0;
            border: 1px solid #ccc;
        }
        .section {
            margin: 100vh 0; /* Space sections far apart to test scrolling */
        }
    </style>
</head>
<body>
    <h1>Countdown Watcher Test Page</h1>
    
    <div class="section">
        <h2>Section 1 - Top</h2>
        <p>Scroll down to see countdowns that will be detected.</p>
    </div>
    
    <div class="section">
        <h2>Section 2 - Middle</h2>
        <div id="countdown1" class="countdown-timer">Please wait 30 seconds...</div>
        <button onclick="startCountdown()">Start Dynamic Countdown</button>
        <div id="dynamic-countdown" class="countdown" style="display:none;"></div>
    </div>
    
    <div class="section">
        <h2>Section 3 - Bottom</h2>
        <div id="countdown2" class="countdown-timer">Redirecting in 25s</div>
    </div>

    <script>
        // Load the CountdownWatcher
        const script = document.createElement('script');
        script.src = './countdownWatcher.js';
        document.head.appendChild(script);
        
        script.onload = function() {
            console.log('CountdownWatcher script loaded');
            
            // Enable test mode and set enabled state
            window.countdownWatcherTestMode = true;
            window.countdownWatcherTestEnabled = true;  // Set to true to enable
            
            // Initialize the countdown watcher after the script loads
            // No need to wait, since we're in the onload callback
            if (window.CountdownWatcher) {
                new window.CountdownWatcher();
                console.log('CountdownWatcher initialized');
            } else {
                console.error('CountdownWatcher not found');
            }
        };
        
        function startCountdown() {
            const element = document.getElementById('dynamic-countdown');
            element.style.display = 'block';
            element.textContent = 'Redirecting in 30 seconds'; // Start with text that matches our criteria
            let count = 29; // Start from 29 to go down to 0
            
            function updateCountdown() {
                element.textContent = `Redirecting in ${count} seconds`;
                count--;
                
                if (count >= 0) {
                    setTimeout(updateCountdown, 1000);
                } else {
                    element.textContent = 'Redirecting now!';
                }
            }
            
            // Start the countdown after a brief moment
            setTimeout(updateCountdown, 1000);
        }
    </script>
</body>
</html>